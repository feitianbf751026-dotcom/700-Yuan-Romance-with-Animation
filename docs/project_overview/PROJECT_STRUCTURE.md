# Project Structure Overview

Last updated: 2025-01-27

This document describes the directory structure and organization of the 700 Yuan Romance project.

## Top-Level Directories

### Root Files

- **`index.html`** - HTML entry point. Contains the root `<div id="root">` where React mounts, and loads `index.tsx` as a module.
- **`index.tsx`** - React entry point. Imports `App` component, loads `styles/index.css`, and mounts the app to the DOM.
- **`App.tsx`** - Main application component. Manages game state (`GameState`), handles game flow (start, choices, endings), and renders `StartScreen` or `GameUI` based on state. Also renders `FireflyPet` component at the root level to ensure it's always visible.
- **`package.json`** - NPM package configuration. Defines scripts (`dev`, `build`, `preview`) and dependencies.
- **`vite.config.ts`** - Vite build configuration. Sets `base: './'` for relative paths (required for Surge.sh deployment).
- **`tsconfig.json`** - TypeScript compiler configuration.
- **`tailwind.config.cjs`** - Tailwind CSS configuration. Defines content paths for CSS purging.
- **`postcss.config.cjs`** - PostCSS configuration. Processes Tailwind CSS and autoprefixer.
- **`vercel.json`** - Vercel deployment configuration (optional, for Vercel deployment).
- **`.gitignore`** - Git ignore rules. Excludes `node_modules/`, `dist/`, build artifacts, and logs.

### `components/` - React Components

React UI components for the game interface.

- **`StartScreen.tsx`** - Initial game start screen. Displays title and start button, calls `onStart` callback.
- **`GameUI.tsx`** - Main game UI component. Displays scene narrative, dialogue, choices, and background images.
- **`FireflyPet.tsx`** - Desktop companion animation component. Renders animated firefly sprites above the game UI.
- **`TypingText.tsx`** - Typewriter effect component. Animates text character-by-character.

### `services/` - Core Game Logic

All game logic, scene definitions, and state management.

#### `services/llmService.ts`
Main game service. Exports `llmService` singleton that manages:
- Player state (`PlayerState`: affection, courage, honesty, path, depth, branch, etc.)
- Scene matching logic (`matchSceneByPath`, `match1ABranch`, `match1BBranch`, `match1CBranch`)
- Intimacy calculation (`calculateIntimacy`)
- Game flow (`startNewGame`, `nextTurnWithChoice`)
- State updates based on choices

#### `services/scenes/` - Scene Definitions
All scene data (narrative, dialogue, choices, endings).

- **`prologue.ts`** - Opening scene (`SCENE_0_PROLOGUE`)
- **`branch1A.ts`** - Branch A scenes (work-focused path)
- **`branch1B.ts`** - Branch B scenes (social/change path)
- **`branch1C.ts`** - Branch C scenes (observation/guilt path)
- **`endings.ts`** - All ending scenes (good, bad, neutral)
- **`shared.ts`** - Shared scenes used across branches
- **`index.ts`** - Exports all scene constants
- Additional files: `branch1A_additional.ts`, `branch1B_additional.ts`, `branch1C_additional.ts`, `enhanced_scenes.ts`, `more_scenes.ts`, `shared_additional.ts`, `branch1A_layer4_6_additional.ts`

#### `services/pathMatcher/` - Path Matching Logic
Functions that determine the next scene based on player's path and depth.

- **`branch1A.ts`** - Branch A path matcher (`match1ABranch`)
- **`branch1B.ts`** - Branch B path matcher (`match1BBranch`)
- **`branch1C.ts`** - Branch C path matcher (`match1CBranch`)
- **`ending.ts`** - Ending matcher (`matchEnding`)
- **`sceneMap.ts`** - Scene mapping configuration (data-driven approach, currently empty array)
- **`utils.ts`** - Utility functions for path matching
- **`index.ts`** - Exports all matcher functions

#### `services/stateManager/` - State Management
State calculation and update logic.

- **`calculator.ts`** - Intimacy and affection calculation functions
- **`updater.ts`** - State update logic based on choices
- **`index.ts`** - Exports state manager functions

#### `services/types.ts`
TypeScript type definitions for game state, scenes, and choices.

### `styles/` - CSS Styles

- **`index.css`** - Tailwind CSS entry point. Contains `@tailwind` directives and custom CSS.

### `public/` - Static Assets

Static files copied to `dist/` during build.

- **`_redirects`** - Surge.sh SPA routing configuration (`/* /index.html 200`)
- **`firefly/`** - Firefly animation sprite images organized by action:
  - `discomfort/`, `eat/`, `left/`, `right/`, `sleep/`, `Standby/`, `Love/`, `mention/`

### `docs/` - Documentation

All project documentation organized by category:
- `project_overview/` - Project structure, configuration, tech design
- `story/` - Story structure and narrative docs
- `branch_design/` - Branch implementation details
- `change_logs/` - Change history
- `audit_review/` - Code audits and reviews
- `ui_reports/` - UI design reports
- And more...

### `dist/` - Build Output (Git-Ignored)

Production build output directory. Generated by `npm run build`, contains:
- `index.html` - Processed HTML
- `assets/` - Bundled JS and CSS files
- `firefly/` - Copied sprite images
- `_redirects` - Copied from `public/`

**Note:** `dist/` is git-ignored because it's a build artifact. It should be regenerated with `npm run build` before deployment.

## Key Entry Points

### Application Flow

1. **`index.html`** → Loads `index.tsx` as module
2. **`index.tsx`** → Imports `App.tsx`, loads `styles/index.css`, mounts React app
3. **`App.tsx`** → Manages game state, renders `StartScreen` or `GameUI`
4. **`GameUI`** → Displays scene from `gameState.currentScene`
5. **User choice** → `App.handleChoice` → `llmService.nextTurnWithChoice` → Updates state → New scene

### Scene Resolution Flow

1. User makes choice → `App.handleChoice(choice)`
2. `llmService.nextTurnWithChoice(history, choice)` called
3. State updated based on choice
4. `llmService.matchSceneByPath(path, depth)` called
5. Branch matcher (`match1ABranch`, `match1BBranch`, or `match1CBranch`) determines next scene
6. Scene data returned from `services/scenes/` exports
7. `App` updates `gameState.currentScene` → `GameUI` re-renders

## File Naming Conventions

- **Components**: PascalCase (e.g., `GameUI.tsx`, `StartScreen.tsx`)
- **Services**: camelCase (e.g., `llmService.ts`)
- **Scenes**: camelCase with branch prefix (e.g., `branch1A.ts`, `prologue.ts`)
- **Types**: camelCase (e.g., `types.ts`)
- **Config files**: lowercase with extension (e.g., `vite.config.ts`, `tailwind.config.cjs`)

## Import Patterns

- **Components**: `import ComponentName from './components/ComponentName'`
- **Services**: `import { llmService } from './services/llmService'`
- **Scenes**: `import { SCENE_NAME } from './services/scenes'`
- **Types**: `import { TypeName } from './types'` or `import { TypeName } from './services/types'`

