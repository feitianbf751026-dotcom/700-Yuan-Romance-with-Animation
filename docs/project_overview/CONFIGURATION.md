# Configuration Guide

Last updated: 2025-01-27

This document explains the build and deployment configuration for the 700 Yuan Romance project.

## Vite Configuration

**File:** `vite.config.ts`

```typescript
export default defineConfig({
  plugins: [react()],
  base: './' // 使用相对路径，确保部署后资源路径正确
})
```

### Why `base: './'`?

The `base: './'` setting configures Vite to use **relative paths** for all assets (JS, CSS, images). This is required for Surge.sh deployment because:

1. **Surge.sh serves from root**: The domain `700-yuan-romance.surge.sh` serves files directly from the `dist/` directory root.
2. **No base path**: Unlike some hosting services that serve from a subdirectory (e.g., `/app/`), Surge.sh doesn't require a base path.
3. **Relative paths work everywhere**: Relative paths (`./assets/...`) work regardless of the deployment URL structure.

**Alternative:** If deploying to a subdirectory (e.g., `https://example.com/app/`), you would set `base: '/app/'`.

## Tailwind CSS Configuration

**File:** `tailwind.config.cjs`

```javascript
module.exports = {
  content: [
    './index.html',
    './index.tsx',
    './App.tsx',
    './components/**/*.{ts,tsx}',
    './services/**/*.{ts,tsx}'
  ],
  theme: {
    extend: {}
  },
  plugins: []
};
```

### Content Paths

The `content` array tells Tailwind which files to scan for class names. This is used for **CSS purging** (removing unused styles in production). All files that use Tailwind classes must be listed here.

**Current paths:**
- `./index.html` - HTML entry point
- `./index.tsx` - React entry point
- `./App.tsx` - Main app component
- `./components/**/*.{ts,tsx}` - All component files
- `./services/**/*.{ts,tsx}` - Service files (in case they use Tailwind classes)

**Note:** Only files that actually use Tailwind classes need to be listed. Service files are included for completeness, but most Tailwind usage is in components.

## PostCSS Configuration

**File:** `postcss.config.cjs`

```javascript
module.exports = {
  plugins: {
    tailwindcss: {},
    autoprefixer: {}
  }
};
```

### Purpose

PostCSS processes CSS files during the build. This configuration:

1. **`tailwindcss`**: Processes Tailwind directives (`@tailwind base`, `@tailwind components`, `@tailwind utilities`) in `styles/index.css`
2. **`autoprefixer`**: Automatically adds vendor prefixes (`-webkit-`, `-moz-`, etc.) for browser compatibility

**Build flow:**
1. Vite processes `styles/index.css`
2. PostCSS runs Tailwind and Autoprefixer
3. Final CSS is bundled into `dist/assets/index-*.css`

## TypeScript Configuration

**File:** `tsconfig.json`

TypeScript configuration for type checking and compilation. Key settings:

- **`"module": "ESNext"`** - Uses ES modules (matches Vite's module system)
- **`"target": "ES2020"`** - Compiles to ES2020 (modern browser support)
- **`"jsx": "react-jsx"`** - React JSX transform
- **`"strict": true`** - Enables strict type checking

## Build Scripts

**File:** `package.json`

```json
{
  "scripts": {
    "dev": "vite",
    "build": "tsc && vite build",
    "preview": "vite preview"
  }
}
```

### Script Breakdown

1. **`npm run dev`**
   - Runs `vite` (dev server)
   - Starts development server at `http://localhost:5173`
   - Hot module replacement (HMR) enabled
   - No type checking (faster startup)

2. **`npm run build`**
   - Runs `tsc` (TypeScript type checking)
   - Then runs `vite build` (production build)
   - Outputs to `dist/` directory
   - Type checking must pass before build proceeds

3. **`npm run preview`**
   - Runs `vite preview` (preview production build)
   - Serves `dist/` directory locally
   - Useful for testing production build before deployment

## Git Configuration

### `.gitignore`

**File:** `.gitignore`

```
node_modules
dist
build
*.log
.DS_Store
.env
.env.local
.env.production.local
.env.development.local
*.patch
```

### Why `dist/` is Git-Ignored

The `dist/` directory is excluded from Git because:

1. **Build artifact**: `dist/` is generated by `npm run build` from source files
2. **Regenerable**: Can be recreated anytime with `npm run build`
3. **Avoids conflicts**: Prevents merge conflicts from generated files
4. **Keeps repo clean**: Only source code is tracked, not build outputs

**Deployment workflow:**
1. Developer runs `npm run build` locally
2. `dist/` is generated
3. `dist/` is deployed to Surge.sh (or other hosting)
4. `dist/` is not committed to Git

**Note:** Some projects commit `dist/` for GitHub Pages or similar services. This project uses Surge.sh, which builds from source or deploys pre-built `dist/`.

## Surge.sh Deployment Configuration

### `public/_redirects`

**File:** `public/_redirects`

```
/* /index.html 200
```

This file is copied to `dist/_redirects` during build. It configures Surge.sh to:

- **Redirect all routes to `index.html`**: Required for Single Page Application (SPA) routing
- **Return 200 status**: Treats all routes as valid (prevents 404s on refresh)

**Why needed:**
- React Router (if used) or direct navigation might use routes like `/game` or `/ending`
- Surge.sh needs to serve `index.html` for all routes so React can handle routing client-side
- Without this, refreshing on a route like `700-yuan-romance.surge.sh/game` would return 404

### Deployment Command

```bash
# Build first
npm run build

# Deploy to Surge.sh
cd dist
surge . 700-yuan-romance.surge.sh
```

**Steps:**
1. `npm run build` generates `dist/` with all assets
2. `cd dist` changes to build directory
3. `surge . 700-yuan-romance.surge.sh` deploys `dist/` contents to the specified domain

**Note:** Surge.sh CLI must be installed and authenticated:
```bash
npm install -g surge
surge login
```

## Vercel Configuration (Optional)

**File:** `vercel.json`

```json
{
  "buildCommand": "npm run build",
  "outputDirectory": "dist",
  "devCommand": "npm run dev",
  "installCommand": "npm install",
  "framework": "vite",
  "rewrites": [
    {
      "source": "/(.*)",
      "destination": "/index.html"
    }
  ]
}
```

This configuration allows deployment to Vercel as an alternative to Surge.sh. The `rewrites` rule serves the same purpose as `public/_redirects` for Surge.sh (SPA routing).

## Environment Variables

Currently, the project does not use environment variables. If needed in the future:

1. Create `.env` files (`.env.local`, `.env.production.local`, etc.)
2. Access via `import.meta.env.VITE_*` in Vite
3. Add `.env*` to `.gitignore` (already included)

## Summary

| Configuration | File | Purpose |
|--------------|------|---------|
| **Vite** | `vite.config.ts` | Build tool config, sets `base: './'` for relative paths |
| **Tailwind** | `tailwind.config.cjs` | CSS framework config, defines content paths for purging |
| **PostCSS** | `postcss.config.cjs` | CSS processing (Tailwind + Autoprefixer) |
| **TypeScript** | `tsconfig.json` | Type checking and compilation settings |
| **Git** | `.gitignore` | Excludes `dist/`, `node_modules/`, build artifacts |
| **Surge.sh** | `public/_redirects` | SPA routing configuration |
| **Vercel** | `vercel.json` | Alternative deployment configuration |

